Это массив указателей на функции (или адресов), хранящийся в памяти микроконтроллера по фиксированному адресу. Каждый элемент таблицы указывает на обработчик конкретного прерывания или исключения.

### **Расположение таблицы**

- Таблица размещается в начале памяти (обычно по адресу **0x00000000** для Cortex-M).
- Адрес начала таблицы определяется **регистром VTOR** (Vector Table Offset Register). В большинстве случаев, VTOR указывает на начало флеш-памяти, но можно изменить его значение для размещения таблицы в оперативной памяти.

## **Структура таблицы**

1. **Начальный стековый указатель (SP)**:
    - Первый элемент таблицы (по адресу 0x00000000) хранит **начальный адрес стека**, который загружается в регистр `SP` после сброса.
2. **Указатель на обработчик Reset**:
    - Второй элемент таблицы (по адресу 0x00000004) — адрес функции, которая выполняется при сбросе системы. Обычно это обработчик `Reset_Handler`.
3. **Адреса обработчиков исключений**:
    - Остальные элементы содержат адреса функций-обработчиков для различных прерываний и исключений.

Пример (на базе ARM Cortex-M):

```
Адрес     Описание
0x0000    Начальный стековый указатель (SP)
0x0004    Обработчик Reset (Reset_Handler)
0x0008    Обработчик NMI (Non-Maskable Interrupt)
0x000C    Обработчик HardFault
0x0010    Обработчик MemManage
0x0014    Обработчик BusFault
...
0x0040    Пользовательские прерывания (IRQ0, IRQ1, ...)
```

---

###  **Прерывания и исключения**

Когда происходит прерывание или исключение:

1. **Аппаратная часть определяет вектор**:
    - Каждый тип прерывания имеет свой номер (например, IRQ0, IRQ1...).
    - Этот номер используется для определения адреса обработчика в таблице:  
        `адрес_обработчика = VTOR + (номер_вектора * 4)`.

2. **Контекст сохраняется**:
    - Процессор сохраняет регистры (например, `PC`, `LR`, `xPSR`) в стек, чтобы после обработки прерывания можно было вернуться к выполнению основной программы.

3. **Переход к обработчику**:
    - Процессор извлекает из таблицы адрес обработчика и передаёт ему управление.

4. **Возврат из обработчика**:
    - После выполнения обработчика команда `BX LR` возвращает управление основной программе.

---

## **Ключевые особенности таблицы векторов**

1. **Фиксированные адреса**:
    
    - Таблица имеет строго заданный формат, определяемый архитектурой (например, Cortex-M).

2. **Переопределение обработчиков**:
    - Обработчики можно переопределить, задавая свои функции вместо стандартных.

3. **Перемещение таблицы**:
    - Для динамических систем VTOR позволяет перемещать таблицу, например, в RAM.

---

## **Пример таблицы векторов**

```c
// Определение начального стека
extern uint32_t _estack;

// Прототипы обработчиков
void Reset_Handler(void);
void NMI_Handler(void);
void HardFault_Handler(void);
void Default_Handler(void);

// Таблица векторов
__attribute__((section(".isr_vector")))
const uint32_t VectorTable[] = {
    (uint32_t)&_estack,           // Начальный стек
    (uint32_t)Reset_Handler,      // Reset Handler
    (uint32_t)NMI_Handler,        // NMI Handler
    (uint32_t)HardFault_Handler,  // Hard Fault Handler
    (uint32_t)Default_Handler,    // MemManage Handler
    (uint32_t)Default_Handler,    // BusFault Handler
    (uint32_t)Default_Handler,    // UsageFault Handler
    // ...
};
```

---

## **Как функции вызываются из таблицы?**

### **Аппаратное управление**

- ARM Cortex-M автоматически определяет адрес обработчика из таблицы векторов и вызывает его при возникновении прерывания.

### **Программное управление**

Если нужно вызвать обработчик вручную:
```c
void (*handler)() = (void (*)())VectorTable[1]; // Обращаемся к Reset_Handler
handler(); // Вызов обработчика
```

## **Практическая работа таблицы векторов**

1. **Обработчик прерывания** Пользователь может написать собственные обработчики:

```c
void SysTick_Handler(void) {
    // Код для обработки прерывания SysTick
}
```

2. **Переопределение обработчиков** Если векторы определены как слабые (`__weak`), можно заменить их:
```c
__weak void HardFault_Handler(void) {
    while (1) {} // Бесконечный цикл при ошибке
}
```

3. **Изменение VTOR** Например, чтобы таблица находилась в RAM:
```c
SCB->VTOR = (uint32_t)&VectorTableRAM;
```