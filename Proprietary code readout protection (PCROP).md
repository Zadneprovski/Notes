Proprietary code readout protection (PCROP) - это аппаратный механизм защиты критичных участков кода во Flash-памяти микроконтроллеров STM32 (серии F2/F4/F7/L4/G0/G4 и др.). Он позволяет заблокировать чтение и выполнение определенных секторов Flash, предотвращая:
- **Копирование прошивки** через отладчик (SWD/JTAG).
- **Извлечение алгоритмов** даже при физическом дампе Flash.
- **Модификацию кода** злоумышленником.
## Как работает PCROP?

1. **Выделение защищаемой области**
    - В Option Bytes настраиваются:
        - Стартовый/конечный адрес секторов Flash.
        - Режим доступа: **только выполнение** (без чтения/записи).
2. **Аппаратная блокировка**
    - При попытке **прочитать** защищенный сектор (через отладчик или DMA) — возвращаются нули или мусор.
    - Код **выполняется нормально**, но его нельзя скопировать или дизассемблировать.
3. **Необратимость** (опционально)
    - В некоторых MCU (например, STM32L4) можно навсегда запретить отключение PCROP через **RDP (Read Protection Level 2)**.

## Зачем PCROP, если есть RDP

### а) RDP (Level 1/2) — это "тяжёлая артиллерия"

- **Блокирует ВСЮ Flash** — нельзя обновлять даже безопасные части прошивки.
- **Для снятия защиты нужно полное стирание** (переход в RDP Level 0), что неудобно для сервиса.
- **Не защищает от физического дампа** — злоумышленник может выпаять Flash и прочитать её (хоть и с трудностями).
### б) PCROP — точечная защита

- **Можно оставить часть прошивки открытой** (например, для обновлений через Bootloader).
- **Критичный код защищён** (алгоритмы, ключи), но остальная логика доступна для модификации.
- **Не мешает отладке** незащищённых модулей.
## 3. Практические сценарии для PCROP

### Пример 1: Защита алгоритма, но с возможностью обновлений

```c
// Защищённая зона (PCROP) — нельзя прочитать, но можно выполнять
__attribute__((section(".pcrop"))) void AES_Encrypt(uint8_t* data) {
    // Секретный алгоритм
}

// Открытая зона — можно обновлять
void User_App() {
    // Бизнес-логика
}
```
### Пример 2: Безопасный Bootloader

- **PCROP-зона**: Проверка цифровой подписи обновлений.
- **Открытая зона**: Сам код прошивки.

### Пример 3: Защита лицензионного ключа

```c
// Ключ в защищённой зоне
__attribute__((section(".pcrop"))) const uint8_t LicenseKey[16] = { ... };

// Проверка лицензии (код можно обновлять)
bool Check_License() {
    return verify_signature(LicenseKey);
}
```

