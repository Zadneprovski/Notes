В ARM Cortex-M, **Program Status Register (PSR)** — это **специальный регистр**, содержащий **флаги состояния** процессора. Он влияет на поведение процессора и сообщает о его текущем состоянии. Это ключевая часть архитектуры, особенно при отладке, работе с прерываниями и при написании низкоуровневого кода.

---

## Состав PSR

Фактически PSR в Cortex-M — это **объединение трёх логических регистров**:

1. **APSR (Application Program Status Register)**
2. **IPSR (Interrupt Program Status Register)**
3. **EPSR (Execution Program Status Register)**

Они **физически объединены в один 32-битный регистр** под названием `xPSR`.
## 1. APSR (Application PSR)

Это часть PSR, содержащая **флаги условий**, как в классических архитектурах:

|Флаг|Название|Значение|
|---|---|---|
|N|Negative|Установлен, если результат отрицательный|
|Z|Zero|Установлен, если результат равен 0|
|C|Carry|Перенос или заём (при арифм. операциях)|
|V|Overflow|Переполнение|
|Q|Saturation|Результат операции насыщения|

Примеры применения:

- Ветвления `if (x == 0)` → зависит от Z-флага.
- Арифметика с проверкой переполнения → V и C флаги.

---

## 2. IPSR (Interrupt PSR)

Содержит номер текущего активного **исключения (exception)** или **прерывания (IRQ)**.

- 0 — если активного прерывания нет (т.е. в **Thread mode**).
    
- 1 и выше — соответствуют системным исключениям и IRQ.
    

Пример:
```c
uint32_t isr = __get_IPSR();
```

Если `isr != 0`, значит вы в прерывании.

---

## 3. EPSR (Execution PSR)

Содержит техническую информацию о состоянии процессора:

|Бит|Название|Значение|
|---|---|---|
|T|Thumb bit|Всегда 1 на Cortex-M (Thumb-2 ISA)|
|IT|If-Then|Для IT-блоков (условные инструкции)|

> Bit T (бита 24): Cortex-M работает **только в Thumb режиме**, поэтому `T = 1`.

---

## Как прочитать PSR

ARM CMSIS предоставляет функции:
```c
uint32_t psr = __get_xPSR();   // Получить весь PSR
uint32_t apsr = __get_APSR();  // Только APSR
uint32_t ipsr = __get_IPSR();  // Только IPSR
```

