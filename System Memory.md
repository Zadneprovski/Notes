**System Memory** — это область ПЗУ (ROM), в которую встроен **фирменный загрузчик от ST**. Этот загрузчик позволяет прошивать микроконтроллер **без использования программатора**, через стандартные интерфейсы (например, UART, USB или CAN).

## Зачем загружаться из System Memory?

Режим загрузки из System Memory используется для:

- **Прошивки микроконтроллера без отладчика** (через UART, USB, CAN и др.)
- **Восстановления MCU**, если в основной Flash записана нерабочая прошивка
- **Обновления прошивки в поле**
- **Автоматизации загрузки прошивки на производстве**

## Как активировать System Memory Boot Mode?

Есть два основных способа:
### 1. **Аппаратно (BOOT0 = 1):**

- При подаче высокого уровня на пин **BOOT0** и последующем сбросе, STM32 загружается из ROM, а не из основной Flash.
- Это наиболее надёжный способ запуска загрузчика.

### 2. **Программно:**

- Из вашей пользовательской прошивки можно **прыгнуть в загрузчик**, сбросив периферию, отключив прерывания и установив MSP.
- Требует аккуратной реализации, иначе переход может не сработать.

## Поддерживаемые интерфейсы загрузки

В зависимости от модели STM32, встроенный загрузчик может поддерживать:

|Интерфейс|Поддержка|Примечание|
|---|---|---|
|UART|✅|Почти во всех STM32|
|USB (DFU)|✅|На некоторых моделях (STM32F1, F4, L4 и др.)|
|CAN|✅|Поддерживается не везде, требует трансивера|
|I2C|☑️|У некоторых чипов|
|SPI|☑️|Очень ограниченно (например, STM32F072)|
|USART + IrDA|☑️|Редко используется|

Уточнить список поддерживаемых интерфейсов можно в официальном документе от ST:

**AN2606 – STM32 System Memory Boot Mode**  

## Нужно ли инициализировать периферию вручную?

**Нет.** Весь нужный код уже встроен в ROM загрузчик:

- Загрузчик **сам настраивает тактирование**
- **Инициализирует периферию** (UART, USB, CAN)
- Настраивает пины и **ждёт подключения хоста**

Вам не нужно писать ни строчки кода, чтобы начать прошивку — достаточно правильно выбрать BOOT режим и подключиться, например, через **STM32CubeProgrammer**.

## Безопасность и ограничения

### Преимущества:

- **ROM неизменяем** — загрузчик нельзя повредить.
- Почти невозможно "окирпичить" STM32, если есть доступ к BOOT0.
- Поддержка стандартных протоколов загрузки (в т.ч. DFU, CAN).

### Недостатки:

- **Функциональность ограничена** — только базовые операции (erase, write, go).
- **Нельзя обновить загрузчик** — он зашит навсегда.
- **Ограничения по интерфейсам** — некоторые модели поддерживают только UART.
- Не проверяется [[Цифровая подпись кода для микроконтроллеров]] или целостность прошивки (если не реализовать отдельно).

## Может ли MCU "окирпичиться"?

**Нет**, если вы используете загрузку через встроенный ROM-загрузчик.  
Даже при неудачной прошивке вы можете загрузиться из System Memory и восстановить устройство.

**Да**, если вы:

- Записали неработающую прошивку **и не предусмотрели доступ к BOOT0**
- Включили **RDP level 2** — защита, при которой микроконтроллер нельзя больше перепрошить вообще
- Отключили аппаратно интерфейсы, нужные загрузчику