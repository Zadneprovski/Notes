[[ffmpeg или opencv]]

FFmpeg — это мощный и гибкий инструмент для обработки мультимедиа (аудио и видео) файлов и потоков. Он поддерживает широкий спектр форматов и кодеков, что делает его незаменимым в задачах, связанных с конвертацией, записью, трансляцией и редактированием мультимедийного контента.

### Основные возможности FFmpeg

1. **Конвертация форматов**:
    
    - Поддержка множества форматов, включая MP4, AVI, MKV, FLV, MOV и многие другие.
    - Возможность конвертировать аудио и видео файлы из одного формата в другой.
2. **Запись и захват видео**:
    
    - Запись видео с экрана.
    - Захват видео с веб-камер и других видеоустройств.
3. **Потоковая передача**:
    
    - Создание потоков для трансляции через интернет.
    - Поддержка различных протоколов для потоковой передачи, таких как RTMP, HLS, DASH и другие.
4. **Редактирование видео и аудио**:
    
    - Объединение, нарезка и кадрирование видео.
    - Изменение разрешения, битрейта и других параметров.
    - Наложение фильтров и эффектов.
5. **Извлечение аудио из видео и наоборот**:
    
    - Извлечение аудиодорожек из видеофайлов.
    - Добавление аудиодорожек к видеофайлам.

### Установка FFmpeg

Для установки FFmpeg на различные операционные системы можно использовать следующие команды:

- **Linux** (например, Ubuntu):
    
    `sudo apt update sudo apt install ffmpeg`
    
### Основные команды FFmpeg

1. **Конвертация видеофайла из одного формата в другой**:
    
    `ffmpeg -i input.mp4 output.avi`
    
2. **Извлечение аудио из видео**:
    
    `ffmpeg -i input.mp4 -vn -acodec copy output.aac`
    
3. **Слияние нескольких видеофайлов**: Создайте текстовый файл `filelist.txt` со списком файлов:
    
    `file 'video1.mp4' file 'video2.mp4'`
    
    `ffmpeg -f concat -i filelist.txt -c copy output.mp4`
    
4. **Сжатие видео с изменением разрешения и битрейта**:
    
    `ffmpeg -i input.mp4 -vf scale=1280:720 -b:v 1M output.mp4`
    
5. **Запись экрана**:
    
    `ffmpeg -video_size 1920x1080 -framerate 25 -f x11grab -i :0.0 output.mp4`
   
6. **Потоковая передача видео (пример с RTMP)**:
  
    `ffmpeg -re -i input.mp4 -c:v libx264 -f flv rtmp://live.twitch.tv/app/stream_key`
    

### Примеры использования

1. **Конвертация видео в аудио**:
    
    `ffmpeg -i video.mp4 -vn -acodec mp3 audio.mp3`
    
2. **Добавление водяного знака к видео**:
    
    `ffmpeg -i input.mp4 -i watermark.png -filter_complex "overlay=10:10" output.mp4`
    
3. **Создание GIF из видео**:
  
    `ffmpeg -i input.mp4 -vf "fps=10,scale=320:-1:flags=lanczos" output.gif`

### Захват видео
```bash
ffmpeg -f v4l2 -i /dev/video0 output.mp4
```

```bash
ffmpeg -f v4l2 -framerate 30 -video_size 1920x1080 -i /dev/video0 output.mp4
```

### Захват и вывод видео с камеры на экран в реальном времени
Для захвата видео с камеры и вывода его на экран в реальном времени на Linux с помощью FFmpeg, можно использовать `ffplay`, который является частью FFmpeg и предназначен для воспроизведения мультимедийных файлов и потоков.

1. **Захват видео с камеры и вывод на экран:**
    
    Для этого используйте команду:
    
    `ffmpeg -f v4l2 -i /dev/video0 -f sdl "SDL output"`
    
    В этой команде:
    
    - `-f v4l2` указывает FFmpeg использовать Video4Linux2 для захвата видео.
    - `-i /dev/video0` указывает устройство захвата (ваша камера).
    - `-f sdl "SDL output"` указывает использовать SDL для вывода видео на экран.
2. **Использование ffplay для вывода видео:**
    
    Проще использовать `ffplay`, который специально предназначен для воспроизведения видео в реальном времени. Используйте команду:
    
    `ffplay -f v4l2 -i /dev/video0`
    

### Примеры использования дополнительных параметров

1. **Указание разрешения и частоты кадров:**
    
    Вы можете указать разрешение и частоту кадров для захвата видео с камеры:
    
    `ffplay -f v4l2 -framerate 30 -video_size 1920x1080 -i /dev/video0`
    
    В этой команде:
    
    - `-framerate 30` задает частоту кадров 30 fps.
    - `-video_size 1920x1080` задает разрешение 1920x1080.
2. **Добавление аудио (если камера поддерживает запись аудио):**
    
    Если ваша камера также поддерживает запись аудио, вы можете добавить аудио вход:
    
    `ffplay -f v4l2 -framerate 30 -video_size 1920x1080 -i /dev/video0 -f alsa -i hw:0`
    
    В этой команде:
    
    - `-f alsa -i hw:0` указывает FFmpeg использовать ALSA (Advanced Linux Sound Architecture) для захвата аудио.

### Передача видео с камеры по UDP

```bash
ffmpeg -f v4l2 -i /dev/video0 -f mpegts udp://<remote_ip>:<remote_port>
```

### Команда для приема видео на удаленном компьютере

```bash
ffplay udp://@:12345
```