**Бит-бэндинг** — это аппаратный механизм в архитектуре ARM Cortex-M, позволяющий получить доступ к отдельному биту памяти как к полноценному 32-битному слову. Это упрощает атомарную работу с отдельными битами, особенно в многозадачных и прерываемых системах, где важно обеспечить безопасный доступ к данным без риска коллизий.

### Как это работает

ARM Cortex-M предоставляет специальную область памяти — **bit-band alias region**, где каждому биту в оригинальном регионе сопоставляется 32-битное слово. Запись значения `0` или `1` по этому адресу приводит к установке или сбросу соответствующего бита в исходной памяти.

Существует две пары адресов:

- SRAM:
    - Регион битов: `0x20000000 – 0x200FFFFF`
    - Alias: `0x22000000 – 0x23FFFFFF`

- Перефирийные регистры:
    - Регион битов: `0x40000000 – 0x400FFFFF`
    - Alias: `0x42000000 – 0x43FFFFFF`

---

### Формула адреса бит-бэндинга

Чтобы получить адрес конкретного бита в бит-бэндинг области, используется следующая формула:

```c
bit_word_addr = bit_band_base + (byte_offset * 32) + (bit_number * 4)
```
- `bit_band_base` — базовый адрес alias-региона (например, `0x22000000`).
- `byte_offset` — смещение байта от начала оригинального региона.
- `bit_number` — номер бита в байте (от 0 до 7).

---

### Зачем нужно умножение на 32 и на 4?

**`byte_offset * 32`**  
В каждом байте 8 бит. Бит-бэндинг представляет каждый из этих битов в виде отдельного 32-битного слова. Таким образом, каждому байту в оригинальной памяти соответствует 8 слов по 4 байта = 32 байта. Смещение по байтам в оригинальной памяти масштабируется на 32 в alias-области.

**`bit_number * 4`**  
Внутри этих 32 байт каждый бит занимает 4 байта. Поэтому для доступа к конкретному биту нужно сместиться на `bit_number * 4` байта внутри блока, соответствующего байту.

---

### Пример

Допустим, мы хотим получить доступ к 3-му биту в 10-м байте региона SRAM (смещение `0x2000000A`, бит номер 3).

- `bit_band_base = 0x22000000`
- `byte_offset = 0x0A`
- `bit_number = 3`

Подставляем в формулу:
```c
bit_word_addr = 0x22000000 + (0x0A * 32) + (3 * 4)
              = 0x22000000 + 320 + 12
              = 0x2200014C
```