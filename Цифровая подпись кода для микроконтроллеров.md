
Цифровая подпись кода для микроконтроллеров (включая STM32) — это **механизм защиты прошивки от подделки или изменения**, гарантирующий, что исполняемый код:

1. **Создан авторизованным разработчиком**
2. **Не был изменён злоумышленником или случайно повреждён**

## Что такое цифровая подпись?

Цифровая подпись — это криптографическая конструкция, которая позволяет:

- Защитить код от модификации
- Проверить, что он **подписан вашим приватным ключом**
- Обеспечить **подлинность и целостность**

## Как это работает:

1. **Вы создаёте прошивку** (например, `firmware.bin`)
2. Вычисляется её **хеш** (например, SHA-256)
3. Этот хеш **подписывается закрытым ключом** → получается **подпись**
4. Прошивка + подпись записываются в память МК

На микроконтроллере:

- Имеется **публичный ключ**
- МК **проверяет подпись перед запуском кода**
    - Если прошивка модифицирована — проверка не пройдёт, загрузка не произойдёт

## Зачем это нужно?

| Угроза                         | Как защищает цифровая подпись                     |
| ------------------------------ | ------------------------------------------------- |
| Подмена прошивки               | Только авторизованный разработчик может подписать |
| Случайное повреждение          | Подпись не пройдёт валидацию                      |
| Физический доступ к устройству | Без приватного ключа нельзя подделать подпись     |
| OTA-обновления                 | Только проверенные обновления загружаются         |

---

## Поддержка в STM32

### 1. **TrustZone / Secure Boot (STM32L5, STM32H5, STM32U5, STM32H7)**

- Встроенная поддержка **криптографической проверки подписи**
- Использует STM32 Secure Firmware Install (SFI), Secure Boot (SB), и Root of Trust

### 2. **Secure Firmware Install (SFI)**

- Загрузка подписанной прошивки **на производстве**
- Защищает процесс установки начальной прошивки

### 3. **Secure Boot / Secure Firmware Update (SBSFU)**

- Пример загрузчика с поддержкой **ECDSA-подписи**
- Доступен как часть пакета **STM32CubeExpansion_SBSFU**

## Чем подписывают?

Обычно используется:

- **Алгоритм:** ECDSA (на кривой NIST P-256), либо RSA
- **Хеш-функция:** SHA-256
- **Инструменты:** OpenSSL, STM32 Trusted Package Creator, STM32CubeProgrammer

## Что ещё важно?

- Подпись — это **не шифрование**, она **не скрывает** код, только проверяет его подлинность.
- Для конфиденциальности используют **шифрование прошивки**, тоже поддерживается в STM32 TrustZone/SFI.
- Цифровая подпись особенно важна при **OTA-обновлениях** и массовом производстве.