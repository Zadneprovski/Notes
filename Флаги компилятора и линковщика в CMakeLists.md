## Компилятор

|Флаг|Описание|
|---|---|
|`-mcpu=cortex-m4`|Указывает компилятору целевую архитектуру — ядро Cortex-M4. Нужно для корректной генерации инструкций и оптимизаций.|
|`-mfpu=fpv4-sp-d16`|Включает поддержку **аппаратного FPU** (FPU = Floating Point Unit) с 16 регистрами и только **одинарной точностью** (single precision). Используется вместе с `-mfloat-abi=hard` или `softfp`.|
|`-mfloat-abi=soft`|Указывает использовать **программную эмуляцию** FPU. То есть, инструкции FPU не будут сгенерированы — вычисления делаются в ПО (медленно). Если у тебя **есть FPU**, лучше использовать `-mfloat-abi=hard`.|
|`-mthumb`|Включает генерацию **Thumb-инструкций** (16/32-битный компактный набор инструкций ARM). Обязательно для Cortex-M.|
|`-Wall`|Включает **все предупреждения** компилятора. Очень полезно для обнаружения потенциальных ошибок.|
|`-Werror`|Превращает **все предупреждения в ошибки**. Удобно на CI или для строгой проверки, но иногда мешает отладки.|
|`-O0`|Отключает все оптимизации. Используется при отладке — сохраняет читаемость ассемблера, но код работает медленно.|

> ⚠️ **Важное замечание:** если ты указал `-mfpu`, но при этом `-mfloat-abi=soft`, компилятор **не будет использовать аппаратный FPU**, даже если он есть. Обычно это ошибка. Лучше указать:

-mfpu=fpv4-sp-d16
-mfloat-abi=hard

Если ты **намеренно** отключаешь FPU — тогда `-mfloat-abi=soft` уместен.

## Линковщик

|Флаг|Описание|
|---|---|
|`-T${LINKER_SCRIPT}`|Указывает **путь к скрипту линковки** (в твоём случае — `STM32G431RBTX_FLASH.ld`). Определяет структуру памяти и секций.|
|`--specs=nano.specs`|Использует **упрощённую версию `newlib`**, оптимизированную по размеру (например, `printf` без `float`).|
|`--specs=nosys.specs`|Отключает системные вызовы `newlib`, заменяя их пустыми заглушками (`_sbrk`, `_exit`, и т. д.). Подходит для "bare-metal" без OS.|
|`-Wl,-Map=${PROJECT_NAME}.map`|Генерирует **.map файл**, который показывает, как компоновщик разложил символы в памяти. Очень полезно для анализа.|
|`-Wl,--gc-sections`|Удаляет **неиспользуемые функции и данные** на этапе линковки. Снижает размер прошивки. Требует `-ffunction-sections -fdata-sections` на компиляции.|
|`-static`|Линкует **статически** (не использует динамические библиотеки, которые и так не поддерживаются в embedded).|
|`-Wl,--start-group ... -Wl,--end-group`|Указывает линковщику **повторно проходить по библиотекам**, чтобы корректно разрешить взаимозависимости (`libc`, `libm` и т. д.).|
|`-lc`|Линкует с `libc` — стандартной C-библиотекой (`newlib`, `newlib-nano`).|
|`-lm`|Линкует с `libm` — библиотекой математических функций (`sin`, `cos`, `sqrt`, и т. д.).|