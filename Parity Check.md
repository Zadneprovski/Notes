**Parity Check (Контроль чётности)** — это простой метод обнаружения ошибок в данных, используемый в компьютерных системах, оперативной памяти (RAM), сетевых протоколах и других областях.

В STM32 с поддержкой **Parity Check** (например, в категориях 2, 3 и 4) проверка чётности реализована для **SRAM1 и CCM SRAM** и работает автоматически на аппаратном уровне. Разберём процесс детально:

###  **Как работает проверка чётности в SRAM/CCM SRAM?**

1. **Структура данных**
    
    - Каждый **байт (8 бит)** в SRAM дополняется **1 битом чётности** (всего 9 бит на байт).
    - Шина данных становится **36-битной** (32 бита данных + 4 бита чётности, по 1 биту на каждый байт).

2. **Когда вычисляется бит чётности?**
    
    - **При записи** в SRAM:  
        Контроллер памяти **автоматически вычисляет** бит чётности для каждого записываемого байта (чётность количества единиц в байте) и сохраняет его вместе с данными.
        
        - Пример (Even Parity):  
            Данные: `0xA5` (`10100101` → 4 единицы → бит чётности `0`).  
            В SRAM сохраняется `10100101` + `0`.

3. **Когда проверяется чётность?**
    
    - **При чтении** из SRAM:  
        Контроллер заново вычисляет чётность для прочитанного байта и сравнивает с сохранённым битом чётности.
        
        - Если биты не совпадают → **ошибка чётности** (один или несколько бит в байте изменились).
    
4. **Реакция на ошибку**
    
    - Генерируется **NMI (Non-Maskable Interrupt)** — прерывание, которое нельзя игнорировать.
    - Устанавливается флаг **SPF (SRAM Parity Error Flag)** в регистре `SYSCFG_CFGR2`.
    - Ошибка может также быть привязана к:
        - Входу **BRK_IN** таймеров (TIM1, TIM8 и др.) для аварийной остановки.
        - Сигналу **hrtim_sys_flt** (для высокоточных таймеров).

### **Критические нюансы**

1. **Инициализация памяти**
    - Перед включением проверки чётности (**SRAM_PE = 1** в Option Bytes) **весь SRAM/CCM SRAM должен быть заполнен** (например, нулями).
    - **Почему?** При чтении неинициализированной памяти могут случайно срабатывать ошибки чётности (в не записанных ячейках — "мусор").
2. **Типы ошибок, которые обнаруживаются**
    - **Одиночные битовые ошибки** (чётность не совпадёт, если изменилось нечётное число бит).
    - **Двойные ошибки** (чётное число изменений) **не обнаруживаются** — для этого нужен ECC.
3. **Производительность**
    - Проверка происходит **аппаратно**, без нагрузки на CPU.

