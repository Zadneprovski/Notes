## Немного теории: как работает тактирование STM32

STM32 (как и другие микроконтроллеры) имеет **системную частоту** — например, 72 МГц. Но **не всем блокам нужна такая высокая частота**, и поэтому внутри микроконтроллера стоят **делители** (prescalers), которые уменьшают частоту:

- AHB делитель — для шины памяти (CPU, DMA и т.п.)
- APB делитель — для периферии (таймеры, USART, SPI и т.п.)

---

## Как задаются делители?

Они **не записываются прямо**, а указываются **в виде кодов** в регистре `RCC->CFGR`. Вот, например, AHB делитель:
```c
Биты 7:4 — HPRE (AHB Prescaler):

0000: SYSCLK не делится (делить на 1)  
1000: делить на 2  
1001: делить на 4  
1010: делить на 8  
1011: делить на 16  
1100: делить на 64  
1101: делить на 128  
1110: делить на 256  
1111: делить на 512  
```

**Код 0b1000** означает **делить на 2**. Но в регистре хранится просто `1000`, и нам нужно понять: "это значит делить на 2".

---

## В чём проблема?

Компьютер не умеет напрямую понять: "1000 — это делить на 2". Поэтому нужна **таблица соответствий**: какая степень двойки соответствует какому коду.

---

## Вот зачем `AHBPrescTable`:
```c
const uint8_t AHBPrescTable[16] = {
  0, 0, 0, 0,    // коды 0000..0111 — делитель 1 → сдвиг на 2^0 = 1
  0, 0, 0, 0,
  1, 2, 3, 4,    // коды 1000..1011 → 2, 4, 8, 16
  6, 7, 8, 9     // коды 1100..1111 → 64, 128, 256, 512
};
```

Что делает эта таблица? Она говорит:

- `AHBPrescTable[8] = 1` → делить на `2^1 = 2`
- `AHBPrescTable[9] = 2` → делить на `2^2 = 4`
- `AHBPrescTable[10] = 3` → делить на `2^3 = 8`
- и так далее...

---

## Как используется в коде

Вот как HAL или CMSIS может рассчитывать частоту шины AHB:
```c
uint32_t ahb_prescaler_code = (RCC->CFGR >> 4) & 0xF; // вырезаем HPRE биты (7:4)
uint32_t ahb_divider = 1 << AHBPrescTable[ahb_prescaler_code]; // 2^N
uint32_t hclk_freq = sysclk_freq / ahb_divider;
```

Пример:

	- `RCC->CFGR` содержит `0x00000080` (биты 7:4 = `1000`)
- Значит: `ahb_prescaler_code = 8`
- `AHBPrescTable[8] = 1`
- `ahb_divider = 1 << 1 = 2`
- Значит, HCLK = SYSCLK / 2


---

## То же самое с APBPrescTable
```c
const uint8_t APBPrescTable[8] = {
  0, 0, 0, 0,  // коды 000..011 → делитель 1
  1, 2, 3, 4   // коды 100..111 → делители 2, 4, 8, 16
};
```